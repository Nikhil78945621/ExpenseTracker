@page "/"
@inject ExpenseTracker.Services.UserService UserService

@code {
    private ExpenseTracker.Components.model.AppData data = new ExpenseTracker.Components.model.AppData();

    protected override void OnInitialized()
    {
        data = UserService.LoadData() ?? new ExpenseTracker.Components.model.AppData();
    }

    private decimal TotalIncomes => data.Incomes?.Sum(i => i.Amount) ?? 0;
    private decimal TotalExpenses => data.Expenses?.Sum(e => e.Amount) ?? 0;
    private decimal TotalDebt => data.Debts?.Sum(d => d.Amount) ?? 0;
    private decimal ClearedDebt => data.Debts?.Sum(d => d.PaidAmount) ?? 0;
    private decimal RemainingDebt => TotalDebt - ClearedDebt;

    private ExpenseTracker.Components.model.Income HighestIncome => data.Incomes?.OrderByDescending(i => i.Amount).FirstOrDefault();
    private ExpenseTracker.Components.model.Expense HighestExpense => data.Expenses?.OrderByDescending(e => e.Amount).FirstOrDefault();
    private ExpenseTracker.Components.model.Debt HighestDebt => data.Debts?.OrderByDescending(d => d.Amount).FirstOrDefault();

    private ExpenseTracker.Components.model.Income LowestIncome => data.Incomes?.OrderBy(i => i.Amount).FirstOrDefault();
    private ExpenseTracker.Components.model.Expense LowestExpense => data.Expenses?.OrderBy(e => e.Amount).FirstOrDefault();
    private ExpenseTracker.Components.model.Debt LowestDebt => data.Debts?.OrderBy(d => d.Amount).FirstOrDefault();
}

<h3 class="text-center text-primary">Expense Tracker Dashboard</h3>

<div class="container mt-4">
    <div class="row">
        <!-- Summary Section -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">Summary</div>
                <div class="card-body">
                    <ul class="list-group">
                        <li class="list-group-item"><strong>Total Incomes:</strong> <span class="text-success">@TotalIncomes</span></li>
                        <li class="list-group-item"><strong>Total Expenses:</strong> <span class="text-danger">@TotalExpenses</span></li>
                        <li class="list-group-item"><strong>Total Debt:</strong> <span class="text-warning">@TotalDebt</span></li>
                        <li class="list-group-item"><strong>Cleared Debt:</strong> <span class="text-success">@ClearedDebt</span></li>
                        <li class="list-group-item"><strong>Remaining Debt:</strong> <span class="text-danger">@RemainingDebt</span></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Statistics Section -->
        <div class="col-md-6">
            <div class="card shadow-sm">
                <div class="card-header bg-dark text-white">Statistics</div>
                <div class="card-body">
                    <ul class="list-group">
                        <li class="list-group-item"><strong>Highest Income:</strong> @HighestIncome?.Amount </li>
                        <li class="list-group-item"><strong>Lowest Income:</strong> @LowestIncome?.Amount </li>
                        <li class="list-group-item"><strong>Highest Expense:</strong> @HighestExpense?.Amount </li>
                        <li class="list-group-item"><strong>Lowest Expense:</strong> @LowestExpense?.Amount </li>
                        <li class="list-group-item"><strong>Highest Debt:</strong> @HighestDebt?.Amount </li>
                        <li class="list-group-item"><strong>Lowest Debt:</strong> @LowestDebt?.Amount </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Pending Debts Table -->
    <div class="mt-4">
        <div class="card shadow-sm">
            <div class="card-header bg-secondary text-white">Pending Debts</div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-bordered table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>User</th>
                                <th>Total Debt</th>
                                <th>Paid Amount</th>
                                <th>Remaining</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var debt in data.Debts)
                            {
                                var user = data.Users.FirstOrDefault(u => u.Id == debt.UserId);
                                <tr>
                                    <td>@user?.Name</td>
                                    <td class="text-warning">@debt.Amount</td>
                                    <td class="text-success">@debt.PaidAmount</td>
                                    <td class="text-danger">@(debt.Amount - debt.PaidAmount)</td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Custom Styling -->
<style>
    .container {
        max-width: 900px;
    }

    .card {
        border-radius: 8px;
    }

    .card-header {
        font-size: 18px;
        font-weight: bold;
    }

    .list-group-item {
        font-size: 16px;
        padding: 10px;
    }

    .table-responsive {
        overflow-x: auto;
    }

    .table th, .table td {
        text-align: center;
        font-size: 16px;
        padding: 12px;
    }
</style>
